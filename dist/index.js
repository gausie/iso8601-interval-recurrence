"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_moment=require("moment"),_moment2=_interopRequireDefault(_moment),IntervalRecurrence=function(){function e(r){var t=r.interval,n=r.recurrence,a=r.strict,i=void 0===a?!0:a;if(_classCallCheck(this,e),n||(n="R0"),t=this._parseISO8601(t,i),n=this._parseISO8601(n,i),!t)throw Error("Invalid interval.");if(void 0!==t.recurrence||void 0===t.date||void 0===t.interval)throw Error("Interval must have a date, an interval and no recurrence.");if(!n)throw Error("Invalid recurrence.");if(void 0===n.recurrence||void 0!==n.date)throw Error("Recurrence must have a recurrence, an interval and no date.");if(void 0===n.interval&&0!==n.recurrence)throw Error("Recurrence can only have no interval if the recurrence is 0.");this.interval=t,this.recurrence=n,this.date=new Date}return _createClass(e,[{key:"containsDate",value:function(e){return e=e||this.date,this._calculateRecurrence(e).containsDate}},{key:"currentRange",value:function(e){e=e||this.date;var r=this._calculateRecurrence(e),t=r.whichRecurrence,n=(r.remainder,r.containsDate);if(!n)return!1;var a=this._calculateRange(t);return{start:a.start.toDate(),end:a.end.toDate(),recurrence:t}}},{key:"_calculateRange",value:function(e){var r=_moment2["default"].duration(this.recurrence.interval).asMilliseconds()*e,t=this.interval.date.clone().add(r,"milliseconds"),n=t.clone().add(this.interval.interval);return{start:t,end:n}}},{key:"_calculateRecurrence",value:function(e){e=_moment2["default"](e);var r,t=e.diff(this.interval.date);r=void 0!==this.recurrence.interval?this.recurrence.interval.asMilliseconds():0,0===r&&(r=1/0);var n,a=Math.floor(t/r),i=t%r;if(this.recurrence.interval&&(this.recurrence.interval.months()>0||this.recurrence.interval.years()>0)){for(var c=(this._calculateRange(n),_moment2["default"].duration()),u=0;a>u;u++)c.add(this.recurrence.interval);for(var l=this.interval.date.clone().add(c),o=l.clone().add(this.interval.interval),s=!1,u=a;s===!1;u++)e.isBetween(l,o)||e.isSame(l)?s=u:(l.add(this.recurrence.interval),o.add(this.recurrence.interval));n=s}else n=a;var d=void 0;return d=n>this.recurrence.recurrence?!1:i>this.interval.interval.asMilliseconds()?!1:!0,{whichRecurrence:n,remainder:i,containsDate:d}}},{key:"_parseISO8601",value:function(e){var r=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];try{e=e.split("/")}catch(t){return!1}var n={};if("R"===e[0].substring(0,1)){var a=e[0].substring(1);if(""===a)n.recurrence=1/0;else{if(a=Number.parseInt(a),Number.isNaN(a))return!1;n.recurrence=a}e.shift()}if(0===e.length)return n;var i,c;try{i=_moment2["default"](e[0],_moment2["default"].ISO_8601,r),c=i.isValid()}catch(t){i=!1,c=!1}var u="P"===e[0].substring(0,1)&&_moment2["default"].duration(e[0])>0;if(2===e.length){var l,o;try{l=_moment2["default"](e[1],_moment2["default"].ISO_8601,r),o=l.isValid()}catch(t){l=!1,o=!1}var s="P"===e[1].substring(0,1)&&_moment2["default"].duration(e[1])>0;if(c&&o)return void 0!==n.recurrence?!1:(n.date=i,n.interval=_moment2["default"].duration(l.diff(i)),n);if(c&&s)return n.date=i,n.interval=_moment2["default"].duration(e[1]),n;if(u&&o){var d=_moment2["default"].duration(e[0]);return n.date=l.subtract(d),n.interval=d,n}return!1}return 1===e.length?c?n.recurrence?!1:(n.date=i,n):u?(n.interval=_moment2["default"].duration(e[0]),n):!1:!1}}]),e}();exports["default"]=IntervalRecurrence,module.exports=exports["default"];
//# sourceMappingURL=index.js.map