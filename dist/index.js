"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_moment=require("moment"),_moment2=_interopRequireDefault(_moment),IntervalRecurrence=function(){function e(r){_classCallCheck(this,e);var t=r.interval,n=r.recurrence;if(n||(n="R0"),t=this._parseISO8601(t),n=this._parseISO8601(n),!t)throw Error("Invalid interval.");if(void 0!==t.recurrence||void 0===t.date||void 0===t.interval)throw Error("Interval must have a date, an interval and no recurrence.");if(!n)throw Error("Invalid recurrence.");if(void 0===n.recurrence||void 0!==n.date)throw Error("Recurrence must have a recurrence, an interval and no date.");if(void 0===n.interval&&0!==n.recurrence)throw Error("Recurrence can only have no interval if the recurrence is 0.");this.interval=t,this.recurrence=n}return _createClass(e,[{key:"containsDate",value:function(e){return this._calculateRecurrence(e).containsDate}},{key:"currentRange",value:function(e){var r=this._calculateRecurrence(e),t=r.whichRecurrence,n=(r.remainder,r.containsDate);if(!n)return!1;var a=_moment2["default"].duration(this.recurrence.interval).asMilliseconds()*t,i=_moment2["default"](this.interval.date).add(a,"milliseconds"),u=i.add(_moment2["default"].duration(this.interval.interval));return{start:i,end:u}}},{key:"_calculateRecurrence",value:function(e){e=_moment2["default"](e);var r=e.diff(this.interval.date),t=void 0!==this.recurrence.interval?this.recurrence.interval.asMilliseconds():0;0===t&&(t=1/0);var n,a=Math.floor(r/t),i=r%t;return n=a>this.recurrence.recurrence?!1:i>this.interval.interval.asMilliseconds()?!1:!0,{whichRecurrence:a,remainder:i,containsDate:n}}},{key:"_parseISO8601",value:function(e){e=e.split("/");var r={};if("R"===e[0].substring(0,1)){var t=e[0].substring(1);if(""===t)r.recurrence=1/0;else{if(t=Number.parseInt(t),Number.isNaN(t))return!1;r.recurrence=t}e.shift()}if(0===e.length)return 0===r.recurrence?r:!1;var n=_moment2["default"](e[0],_moment2["default"].ISO_8601,!0),a=n.isValid(),i="P"===e[0].substring(0,1)&&_moment2["default"].duration(e[0])>0;if(2===e.length){var u=_moment2["default"](e[1],_moment2["default"].ISO_8601,!0),c=u.isValid(),l="P"===e[1].substring(0,1)&&_moment2["default"].duration(e[1])>0;if(a&&c)return e.recurrence?!1:(r.date=n,r.interval=_moment2["default"].duration(u.diff(n)),r);if(a&&l)return r.date=n,r.interval=_moment2["default"].duration(e[1]),r;if(i&&c){var o=_moment2["default"].duration(e[0]);return r.date=u.subtract(o),r.interval=o,r}return!1}return 1===e.length?a?r.recurrence?!1:(r.date=n,r):i?(r.interval=_moment2["default"].duration(e[0]),r):!1:!1}}]),e}();exports["default"]=IntervalRecurrence,module.exports=exports["default"];
//# sourceMappingURL=index.js.map